<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Example docs | Mokou的小书房</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="Mokou,源码解析,前端,Vue,Vue3,Es6,Javascript">
    <link rel="preload" href="/fed-note/assets/css/0.styles.35bbaf6d.css" as="style"><link rel="preload" href="/fed-note/assets/js/app.48ea0deb.js" as="script"><link rel="preload" href="/fed-note/assets/js/2.666d6ac5.js" as="script"><link rel="preload" href="/fed-note/assets/js/5.e24a0e2b.js" as="script"><link rel="prefetch" href="/fed-note/assets/js/10.5afa6c98.js"><link rel="prefetch" href="/fed-note/assets/js/11.7159faba.js"><link rel="prefetch" href="/fed-note/assets/js/12.04b47d5c.js"><link rel="prefetch" href="/fed-note/assets/js/13.cf7709eb.js"><link rel="prefetch" href="/fed-note/assets/js/14.c394ef89.js"><link rel="prefetch" href="/fed-note/assets/js/15.5700efc9.js"><link rel="prefetch" href="/fed-note/assets/js/16.951e1dbd.js"><link rel="prefetch" href="/fed-note/assets/js/17.eb7fb9a3.js"><link rel="prefetch" href="/fed-note/assets/js/18.41427e8c.js"><link rel="prefetch" href="/fed-note/assets/js/19.003cae70.js"><link rel="prefetch" href="/fed-note/assets/js/20.00fa1dfc.js"><link rel="prefetch" href="/fed-note/assets/js/21.2ecb7e6c.js"><link rel="prefetch" href="/fed-note/assets/js/22.9e0c6173.js"><link rel="prefetch" href="/fed-note/assets/js/23.6870e795.js"><link rel="prefetch" href="/fed-note/assets/js/24.0708c613.js"><link rel="prefetch" href="/fed-note/assets/js/25.671d6a8e.js"><link rel="prefetch" href="/fed-note/assets/js/26.f56c538e.js"><link rel="prefetch" href="/fed-note/assets/js/27.e06285ee.js"><link rel="prefetch" href="/fed-note/assets/js/28.6df8b992.js"><link rel="prefetch" href="/fed-note/assets/js/29.efb48b7f.js"><link rel="prefetch" href="/fed-note/assets/js/3.18950ecf.js"><link rel="prefetch" href="/fed-note/assets/js/30.6cd4682a.js"><link rel="prefetch" href="/fed-note/assets/js/31.6339c2f1.js"><link rel="prefetch" href="/fed-note/assets/js/32.9a4039f7.js"><link rel="prefetch" href="/fed-note/assets/js/33.d07f197e.js"><link rel="prefetch" href="/fed-note/assets/js/34.bf5813f3.js"><link rel="prefetch" href="/fed-note/assets/js/35.f35eaefe.js"><link rel="prefetch" href="/fed-note/assets/js/36.b718a34b.js"><link rel="prefetch" href="/fed-note/assets/js/37.870aa908.js"><link rel="prefetch" href="/fed-note/assets/js/38.112e270d.js"><link rel="prefetch" href="/fed-note/assets/js/39.e2b199b9.js"><link rel="prefetch" href="/fed-note/assets/js/4.9c7f0bce.js"><link rel="prefetch" href="/fed-note/assets/js/40.4b21c256.js"><link rel="prefetch" href="/fed-note/assets/js/41.c47b4127.js"><link rel="prefetch" href="/fed-note/assets/js/42.8707f7e9.js"><link rel="prefetch" href="/fed-note/assets/js/43.228091d0.js"><link rel="prefetch" href="/fed-note/assets/js/44.2fc2b49e.js"><link rel="prefetch" href="/fed-note/assets/js/45.b8c25cfc.js"><link rel="prefetch" href="/fed-note/assets/js/46.27a85c55.js"><link rel="prefetch" href="/fed-note/assets/js/47.fa89fc7d.js"><link rel="prefetch" href="/fed-note/assets/js/48.63d385a9.js"><link rel="prefetch" href="/fed-note/assets/js/49.312e2267.js"><link rel="prefetch" href="/fed-note/assets/js/50.7469e0b3.js"><link rel="prefetch" href="/fed-note/assets/js/51.de9fda8a.js"><link rel="prefetch" href="/fed-note/assets/js/52.ff789772.js"><link rel="prefetch" href="/fed-note/assets/js/53.a3890860.js"><link rel="prefetch" href="/fed-note/assets/js/54.2644983b.js"><link rel="prefetch" href="/fed-note/assets/js/55.712fd631.js"><link rel="prefetch" href="/fed-note/assets/js/56.4a81535c.js"><link rel="prefetch" href="/fed-note/assets/js/57.ff09686a.js"><link rel="prefetch" href="/fed-note/assets/js/58.bb39be1a.js"><link rel="prefetch" href="/fed-note/assets/js/59.1a615610.js"><link rel="prefetch" href="/fed-note/assets/js/6.f60d1f00.js"><link rel="prefetch" href="/fed-note/assets/js/60.87ae7b87.js"><link rel="prefetch" href="/fed-note/assets/js/61.c96def20.js"><link rel="prefetch" href="/fed-note/assets/js/62.73e4ca79.js"><link rel="prefetch" href="/fed-note/assets/js/63.48afd3ab.js"><link rel="prefetch" href="/fed-note/assets/js/64.20c230a9.js"><link rel="prefetch" href="/fed-note/assets/js/65.655d434b.js"><link rel="prefetch" href="/fed-note/assets/js/66.d1ad6f8b.js"><link rel="prefetch" href="/fed-note/assets/js/67.94ee2884.js"><link rel="prefetch" href="/fed-note/assets/js/68.74cd2b1c.js"><link rel="prefetch" href="/fed-note/assets/js/69.218cc8d8.js"><link rel="prefetch" href="/fed-note/assets/js/7.650cad16.js"><link rel="prefetch" href="/fed-note/assets/js/70.e2fbccd9.js"><link rel="prefetch" href="/fed-note/assets/js/71.4ca8b685.js"><link rel="prefetch" href="/fed-note/assets/js/8.3ddcc38d.js"><link rel="prefetch" href="/fed-note/assets/js/9.745d67a5.js">
    <link rel="stylesheet" href="/fed-note/assets/css/0.styles.35bbaf6d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fed-note/" class="home-link router-link-active"><img src="/fed-note/mh.jpg" alt="Mokou的小书房" class="logo"> <span class="site-name can-hide">Mokou的小书房</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fed-note/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="https://github.com/zhongmeizhi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fed-note/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="https://github.com/zhongmeizhi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>深入浅出 Vue3</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue2 &amp;&amp; React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>计算机基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fed-note/browser/security_code.html" class="sidebar-link">前端安全性</a></li><li><a href="/fed-note/browser/page_load.html" aria-current="page" class="active sidebar-link">页面加载过程</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/fed-note/sse/design_model.html" class="sidebar-link">设计模式</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flutter实战</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>服务端相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>简单的API</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其他</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="从输入url到页面加载过程"><a href="#从输入url到页面加载过程" class="header-anchor">#</a> 从输入URL到页面加载过程</h1> <blockquote><p>抛开了对页面的具体分析，任何的性能优化都是站不住脚的，盲目的使用一些优化措施，结果可能会适得其反。因此切实的去分析页面的实际性能表现，不断的改进测试，才是正确的优化途径。</p></blockquote> <h3 id="大致流程"><a href="#大致流程" class="header-anchor">#</a> 大致流程</h3> <ol><li>强缓存（<strong>第一步</strong>）</li> <li>域名解析（DNS查询）</li> <li>(SSL/TLS)握手（https会有）</li> <li>TCP三次握手</li> <li>发送请求（应用层）</li> <li>服务器收到请求</li> <li>协商缓存（<strong>服务器告诉浏览器使用本地缓存</strong>）</li> <li>微服务架构 -&gt; 负载均衡</li> <li>服务器处理请求 并返回响应</li> <li>TCP四次挥手（关闭连接）</li> <li>DOM树 + CSS树 -&gt; 渲染树 -&gt; 重排、重绘
<ul><li>边加载边解析的过程</li> <li>会将各层信息发送给 GPU，GPU将各层合成，显示到屏幕上</li></ul></li> <li>JS资源要等脚本下载完成并执行后才会继续解析HTML（此时可以使用defer和async）
<ul><li>defer是延迟执行。类似放在body后面</li> <li>async是异步执行。下载完毕执行</li></ul></li></ol> <h3 id="网络传输过程"><a href="#网络传输过程" class="header-anchor">#</a> 网络传输过程</h3> <p><img src="/fed-note/assets/img/interweb.40bd3632.png" alt="因特网"></p> <h3 id="域名解析"><a href="#域名解析" class="header-anchor">#</a> 域名解析</h3> <p>IP 查找顺序（查询到就返回）</p> <ol><li>首先从<code>浏览器缓存</code>中查找 IP</li> <li>从<code>Host文件</code>中查找 IP</li> <li>从<code>路由器</code>缓存中查找 IP</li> <li>发送<code>DNS请求</code>到 本地DNS服务器（运营商）</li> <li>从<code>本地DNS服务器</code>缓存中查找 IP</li> <li>以<code>递归</code>的方式往<code>根DNS服务器</code>发起请求</li> <li>以<code>迭代</code>的方式获取能查询的<code>顶级域名服务器</code>位置</li> <li>顶级服务器告诉本地DNS到<code>权限服务器</code>上查询</li> <li>权限服务器将IP返回给本地DNS</li> <li>本地DNS将IP保存到自己的缓存中</li></ol> <p>概念：</p> <ul><li>DNS 即 (domain name system，域名系统)，一个域名和IP地址相互映射的分布式数据库。</li> <li>根域名：全球共13个根服务器 (包含所有顶级域名服务器的域名和IP地址)</li> <li>顶级域名：域名的最后一部分（如：.com、.cn、.net 等）</li> <li>二级域名：域名的倒数第二个部分，如：example.baidu.com中，二级域名是Baidu</li></ul> <h3 id="https"><a href="#https" class="header-anchor">#</a> HTTPS</h3> <blockquote><p>HTTPS（全称：Hyper Text Transfer Protocol over Secure Socket Layer 超文本传输<strong>安全</strong>协议）</p></blockquote> <p>HTTPS在传统的HTTP和TCP之间加了一层用于<code>加密解密的SSL/TLS层</code>（安全套接层Secure Sockets Layer/安全传输层Transport Layer Security）层。</p> <p>PS: 当<code>SSL</code>发展到第三大版本时才被标准版，成为 <code>TLS</code>。即：<code>TLS1.0 = SSL3.1</code></p> <p>使用HTTPS必须要有一套自己的数字证书（<strong>包含公钥和私钥</strong>）。</p> <p>HTTPS解决的问题</p> <ul><li>信息加密传输：第三方无法窃听；</li> <li>校验机制：一旦被篡改，通信双方会立刻发现；</li> <li>身份证书：防止身份被冒充。</li></ul> <p>HTTPS加密过程：</p> <ol><li>客户端请求服务器获取<code>证书公钥</code></li> <li>客户端(SSL/TLS)解析证书（无效会弹出警告）</li> <li>生成随机值</li> <li>用<code>公钥加密</code>随机值生成<strong>密钥</strong></li> <li>客户端将<code>秘钥</code>发送给服务器</li> <li>服务端用<code>私钥</code>解密<code>秘钥</code>得到随机值</li> <li><code>将信息和随机值混合在一起</code>进行对称加密</li> <li>将加密的内容发送给客户端</li> <li>客户端用<code>秘钥</code>解密信息</li></ol> <p><img src="/fed-note/assets/img/https.5596ab39.png" alt="HTTPS"></p> <p>加密过程使用了对称加密和非对称加密。</p> <ul><li>对称加密: <strong>客户端和服务端采用相同的密钥经行加密</strong><div class="language- extra-class"><pre class="language-text"><code>    encrypt(明文，秘钥) = 密文

    decrypt(密文，秘钥) = 明文
</code></pre></div></li> <li>非对称加密：<strong>客户端通过公钥加密。服务端通过私钥解密</strong><div class="language- extra-class"><pre class="language-text"><code>    encrypt(明文，公钥) = 密文

    decrypt(密文，私钥) = 明文
</code></pre></div></li></ul> <p>因为TLS握手的过程中采用了非对称加密，客户端本身不知道服务器的秘钥，这样通信就不会被中间人劫持。此外这一步服务端还提供了证书，并且可能要求客户端提供证书。关于证书下文会提到，只要有了证书，就能保证和你通信的对方是真实的，而不是别人伪造的。</p> <p>那然后验证证书呢？</p> <ol><li>客户端获取到了站点证书，拿到了站点的公钥</li> <li>客户端找到其站点证书颁发者的信息</li> <li><code>站点证书的颁发者</code>验证<code>服务端站点</code>是否可信</li> <li>往上回溯，找到<code>根证书颁发者</code></li> <li>通过<code>根证书颁发者</code>一步步验证<code>站点证书颁布者</code>是否可信</li></ol> <p>附：</p> <ul><li>HTTPS默认使用443端口，而HTTP默认使用80端口。</li> <li>TLS就是从SSL发展而来的，只是SSL发展到3.0版本后改成了TLS</li> <li>第一次请求中TLS握手的代价很大</li> <li>后续的请求会共用第一次请求的协商结果</li></ul> <p>参考：</p> <ul><li><a href="https://www.jianshu.com/p/954961bac588" target="_blank" rel="noopener noreferrer">刘某某_adf3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.jianshu.com/p/24af67c40e8d" target="_blank" rel="noopener noreferrer">jimsshom<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="http2"><a href="#http2" class="header-anchor">#</a> HTTP2</h3> <p>主要改进</p> <ol><li>头部压缩 -&gt; 减少体积
<ul><li>采用<code>HPACK</code>压缩：利用服务器和客户端之间建立哈希表的映射，传递索引来精简和复用请求头部</li></ul></li> <li>多路复用 -&gt; 解决队头阻塞
<ul><li>由于浏览器对HTTP有并发限制（大部分是6个并发），而且HTTP 基于请求-响应的模型，在同一个 TCP 长连接中，前面的请求没有得到响应，后面的请求就会被阻塞。</li> <li>因此，HTTP2 采用多路复用解决HTTP队头阻塞的问题（只需要占用一个 TCP 连接）</li></ul></li> <li>二进制 + 分帧传输 -&gt; 减少体积 + 提高安全性
<ul><li>由于 HTTP 的明文传输解析太过复杂（比如 <code>\n</code> 到底是换行还是字符串？），而且并不安全。所以，采用二进制进行传输</li> <li>将数据以流的形式进行传输，并将请求和响应数据分割成更小的帧，而多个帧之间可以乱序发送，根据帧首部的流标识来重新组装。</li></ul></li> <li>服务器推送</li></ol> <p>PS：2020年2月chrome更改了<code>SameSite</code> 属性（从默认 <code>None</code> 改为 <code>Lax</code>），用以预防<code>CSRF</code> 攻击。</p> <h3 id="tcp三次握手"><a href="#tcp三次握手" class="header-anchor">#</a> TCP三次握手</h3> <ol><li><p>客户端请求建立连接</p></li> <li><p>服务端确认应答</p></li> <li><p>客户端确认应答</p> <p>→ ← →</p></li></ol> <p>三次握手期间，任何1次未收到对面的回复，则都会重发</p> <blockquote><p>目的：应对网络延迟问题，防止网络资源浪费，甚至死锁</p></blockquote> <h3 id="tcp四次挥手"><a href="#tcp四次挥手" class="header-anchor">#</a> TCP四次挥手</h3> <ol><li><p>客户端请求断开连接</p></li> <li><p>服务端应答</p></li> <li><p>服务端请求断开连接</p></li> <li><p>客户端应答</p> <p>→ ← ← →</p></li></ol> <blockquote><p>目的：保证双方都断开连接</p></blockquote> <h3 id="关于缓存"><a href="#关于缓存" class="header-anchor">#</a> 关于缓存</h3> <p>浏览器缓存策略相关：比如Cache-Control、<s>Pragma</s>、ETag、Expires、Last-Modified</p> <p><strong>强缓存</strong>是利用<code>Expires</code>或者<code>Cache-Control</code>这两个http header实现的，命中缓存会返回<code>200</code></p> <ul><li>强缓存是不会产生 DNS 解析的，更不会发送请求（<strong>不请求服务器</strong>）</li> <li><code>expires</code> 有 <strong>服务器时间</strong> 和 <strong>客户端时间</strong> 不一致导致失效的问题</li> <li><code>Cache-Control</code> 在<code>HTTP 1.1</code>中为了解决expires的问题而诞生
<ul><li>单位为秒，<strong>不依赖客户端时间</strong></li> <li><code>Cache-Control</code> 优先级高于 <code>Expires</code></li></ul></li></ul> <p><strong>协商缓存</strong>利用<code>Last-Modified</code>或者<code>Etag</code>这两个http header实现，命中缓存会返回<code>304</code></p> <ul><li>协商缓存由服务器验证缓存的有效性（<strong>请求服务器</strong>）</li> <li>Last-Modified 比较前一个响应头的<code>Last-Modified</code>和新请求头的<code>if-modified-since</code>（单位秒）
<ul><li>根据时间来缓存</li> <li>最后修改只能精确到<code>秒</code>级</li> <li>定期生成文件内容没变化时 Last-Modified 改变</li></ul></li> <li>Etag在 <code>HTTP 1.1</code> 中出现：比较前一个响应头的 <code>Etag</code> 和新请求头的 <code>If-None-Match</code>，
<ul><li>优先级高于Last-Modified</li> <li>基于资源的内容编码生成一串唯一的标识<code>字符串</code>来缓存</li> <li><code>ETag</code> 优先级高于 <code>Last-Modified</code></li></ul></li></ul> <p>在文件变动的时候需要清除缓存。比如：在webpack打包的时候一般会给JS、CSS、图片的文件名添加<code>chunkhash</code>。</p> <p><a href="https://www.jianshu.com/p/65605622234b" target="_blank" rel="noopener noreferrer">参考<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="关于浏览器进程"><a href="#关于浏览器进程" class="header-anchor">#</a> 关于浏览器进程</h3> <p>浏览器是多进程的</p> <p>多进程的优势</p> <ol><li>避免单个标签页影响整个浏览器</li> <li>避免第三方插件影响整个浏览器</li> <li>利用 cpu 的多核优势</li></ol> <p>浏览器进程：主要进程</p> <ol><li>主进程（Browser进程/控制进程）
<ul><li>负责界面展示，与用户交互（前进、后退等）</li> <li>负责各个页面的管理，创建和销毁其他进程</li> <li>将渲染经常的结果绘制到页面上</li> <li>网络资源的管理、下载等</li></ul></li> <li>插件进程
<ul><li>为浏览器插件创建的进程</li></ul></li> <li>GPU进程
<ul><li>用于 3D 绘制</li></ul></li> <li>渲染进程
<ul><li>页面渲染，脚本执行，事件处理</li> <li>每个浏览器标签页都是一个 render进程</li></ul></li></ol> <p>所以：打开浏览器最少会出现2个进程（主进程和标签页的渲染进程）</p> <p>PS：浏览器还有 <code>SharedWorker</code>进程，方便各页面间的交互</p> <h3 id="渲染进程"><a href="#渲染进程" class="header-anchor">#</a> 渲染进程</h3> <p>渲染进程主要包含以下线程： 主要线程</p> <ol><li>GUI 渲染线程
<ul><li>负责渲染浏览器页面（解析HTML、CSS 构建DOM和 RenderObject树，布局和绘制等）</li> <li>当然：重绘(Repaint)和回流(Reflow) 也会触发该线程</li> <li>重点：<strong>GUI渲染线程和JS引擎线程是互斥的</strong>，会在JS引擎空闲时执行</li></ul></li> <li>JS 引擎线程
<ul><li>JS内核（例如: V8引擎）：负责解析、运行 JS脚本程序</li> <li>如果使用 <code>WebWorker</code> 那么JS引擎线程会 向浏览器申请开一个子线程
<ul><li><code>WebWorker</code> 是渲染进程开的子线程，不受JS引擎线程管理</li> <li>JS线程 和 Worker线程的通信通过 <code>postMessage API</code></li> <li><code>postMessage</code> 交互数据需要序列化对象</li></ul></li></ul></li> <li>事件触发线程
<ul><li>宏任务、微任务、事件（比如点击）、AJAX请求等 被事件符合条件触发时。会将任务添加到事件线程中</li> <li>事件触发线程会把事件添加到待处理队列的队尾，等待 JS 引擎处理</li></ul></li> <li>定时器线程
<ul><li>定时器所在的线程（<code>setInterval</code>和<code>setTimeout</code>等）</li> <li>因为JS引擎线程处于阻塞状态会影响计时的准确性，所以单独作为一个线程</li> <li>W3C标准：setTimeout最小间隔为 4ms</li></ul></li> <li>异步http请求线程
<ul><li>处理请求的线程，如果有请求回调函数，会将该回调放入事件队列中，由 JS引擎执行</li></ul></li></ol> <p>PS：</p> <ol><li><code>DOMContentLoaded</code> 事件触发时：仅 <code>DOM</code> 加载完成（不包括css、图片资源、async脚本）</li> <li><code>onload</code> 事件触发时：所有资源都加载完成且渲染完毕</li></ol> <h3 id="页面渲染"><a href="#页面渲染" class="header-anchor">#</a> 页面渲染</h3> <p><img src="/fed-note/assets/img/page_load.b3dc0390.png" alt="页面加载"></p> <p>CSS加载是否阻塞渲染？</p> <ul><li><strong>CSS加载 不会阻塞 DOM树的解析</strong></li> <li><strong>CSS加载 会阻塞 Render树渲染</strong></li> <li><strong>css加载 会阻塞 后续js语句的执行</strong></li></ul> <p>为什么加载不阻塞 DOM 树的解析，但是会阻塞 Render 树的渲染？</p> <ul><li>CSS的加载是由<strong>主进程的下载线程</strong>异步下载的
<ul><li>因为解析过程不影响 渲染流程</li></ul></li> <li>渲染时需要等CSS加载完毕，以获取CSS信息</li> <li>如果css加载不阻塞DOM树渲染的话，那么当css加载完之后，DOM树可能又得重新重绘或者回流了</li></ul> <p>为何 GUI渲染线程 和 JS引擎线程会产生互斥？</p> <p>因为JavaScript是可以操作DOM的，如果再修改这些元素属性的同时渲染页面，那么渲染线程获得的元素数据可能会不一致，（如果不一致那么渲染线程怎么知道该做什么事情？），因此为防止渲染出现异常，所以<strong>当JS引擎执行时 GUI线程 会被挂起，GUI更新会等JS引擎线程空闲时执行</strong>。</p> <h5 id="css图层"><a href="#css图层" class="header-anchor">#</a> css图层</h5> <p>分为：普通图层和复合图层</p> <p>复合图层就是传说中的硬件加速技术，独立于普通文档流中，改动后可以避免整个页面重绘，提升性能，但是也不能大量使用，会导致资源消耗过度。</p> <p>如果变成复合图层？</p> <ol><li><code>translate3d</code>、<code>translateZ</code></li> <li><code>will-change</code>(提前告诉浏览器需要优化) 和 <code>opacity</code>/过渡动画(如：transform) 在动画期间是复合图层</li> <li><code>video</code>、<code>iframe</code>、<code>canvas</code>、<code>webgl</code></li></ol> <p>PS：</p> <ol><li><code>absolute</code> 虽然可以脱离普通文档流，但是无法脱离默认复合层。</li> <li>复合图层的隐式合成：如果a是一个复合图层，而且b在a上面，那么b也会被隐式转为一个复合图层</li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/fed-note/browser/security_code.html" class="prev">
        前端安全性
      </a></span> <span class="next"><a href="/fed-note/sse/design_model.html">
        设计模式
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/fed-note/assets/js/app.48ea0deb.js" defer></script><script src="/fed-note/assets/js/2.666d6ac5.js" defer></script><script src="/fed-note/assets/js/5.e24a0e2b.js" defer></script>
  </body>
</html>
